<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GVN – Database Design</title>
    <link rel="stylesheet" href="/teams/GVN/db.css" />
  </head>

  <body>
    <header>
      <h1>GVN – Gym Programme Planner</h1>
      <nav>
        <a href="/">home</a>
        <a href="/people">people</a>
        <a href="/proposals">proposals</a>
        <a href="/teams">teams</a>
        <a href="/teams/GVN/Team-introduction.html">GVN</a>
      </nav>
    </header>

    <main>
      <section aria-labelledby="db-overview">
        <h2 id="db-overview">Database overview</h2>
        <p>
          This page documents the draft database design for the Gym Programme
          Planner. It covers tables, fields, and relationships, plus example SQL
          queries for the main interactions (registration, login, browsing
          exercises, creating routines, and adding/removing exercises from a
          routine).
        </p>

        <h3>Tables</h3>
        <ul>
          <li>
            <strong>Users</strong> – stores gym members and administrators
          </li>
          <li>
            <strong>Routines</strong> – workout routines created by a user
          </li>
          <li>
            <strong>Categories</strong> – exercise categories managed by admins
          </li>
          <li><strong>Exercises</strong> – exercise library entries</li>
          <li>
            <strong>Routine_Exercises</strong> – junction table linking routines
            and exercises, including sets/reps/order
          </li>
        </ul>
      </section>

      <section aria-labelledby="db-relationships">
        <h2 id="db-relationships">Relationships</h2>

        <ul>
          <li>
            <strong>Users → Routines (one-to-many):</strong> one user can create
            many routines, each routine belongs to one user.
          </li>
          <li>
            <strong>Routines ↔ Exercises (many-to-many):</strong> a routine can
            include many exercises and an exercise can appear in many routines.
            This is resolved using the <strong>Routine_Exercises</strong>
            junction table.
          </li>
          <li>
            <strong>Categories → Exercises (one-to-many):</strong> one category
            contains many exercises, each exercise belongs to one category.
          </li>
        </ul>
      </section>

      <section aria-labelledby="db-structure">
        <h2 id="db-structure">Draft database structure</h2>

        <h3>Users</h3>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Type</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>user_id</td>
              <td>INTEGER</td>
              <td>Primary key</td>
            </tr>
            <tr>
              <td>name</td>
              <td>TEXT</td>
              <td>Required</td>
            </tr>
            <tr>
              <td>email</td>
              <td>TEXT</td>
              <td>Unique, required</td>
            </tr>
            <tr>
              <td>password_hash</td>
              <td>TEXT</td>
              <td>Stored hashed (not plain text)</td>
            </tr>
            <tr>
              <td>role</td>
              <td>TEXT</td>
              <td>Examples: 'member' or 'admin'</td>
            </tr>
          </tbody>
        </table>

        <h3>Routines</h3>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Type</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>routine_id</td>
              <td>INTEGER</td>
              <td>Primary key</td>
            </tr>
            <tr>
              <td>user_id</td>
              <td>INTEGER</td>
              <td>Foreign key → Users.user_id</td>
            </tr>
            <tr>
              <td>routine_name</td>
              <td>TEXT</td>
              <td>Required</td>
            </tr>
          </tbody>
        </table>

        <h3>Categories</h3>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Type</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>category_id</td>
              <td>INTEGER</td>
              <td>Primary key</td>
            </tr>
            <tr>
              <td>category_name</td>
              <td>TEXT</td>
              <td>Unique, required</td>
            </tr>
          </tbody>
        </table>

        <h3>Exercises</h3>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Type</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>exercise_id</td>
              <td>INTEGER</td>
              <td>Primary key</td>
            </tr>
            <tr>
              <td>exercise_name</td>
              <td>TEXT</td>
              <td>Required</td>
            </tr>
            <tr>
              <td>category_id</td>
              <td>INTEGER</td>
              <td>Foreign key → Categories.category_id</td>
            </tr>
          </tbody>
        </table>

        <h3>Routine_Exercises (junction table)</h3>
        <p>
          Links routines and exercises and stores routine-specific settings such
          as sets, reps, and the order the exercises should appear in.
        </p>
        <table>
          <thead>
            <tr>
              <th>Field</th>
              <th>Type</th>
              <th>Notes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td>routine_id</td>
              <td>INTEGER</td>
              <td>Foreign key → Routines.routine_id</td>
            </tr>
            <tr>
              <td>exercise_id</td>
              <td>INTEGER</td>
              <td>Foreign key → Exercises.exercise_id</td>
            </tr>
            <tr>
              <td>sets</td>
              <td>INTEGER</td>
              <td>e.g. 3</td>
            </tr>
            <tr>
              <td>reps</td>
              <td>INTEGER</td>
              <td>e.g. 10</td>
            </tr>
            <tr>
              <td>exercise_order</td>
              <td>INTEGER</td>
              <td>Controls ordering within a routine</td>
            </tr>
          </tbody>
        </table>

        <p>
          <strong>Note:</strong> We can enforce that a routine cannot contain
          the same exercise twice by using a composite primary key or unique
          constraint on (routine_id, exercise_id).
        </p>
      </section>

      <section aria-labelledby="db-queries">
        <h2 id="db-queries">Example SQL queries for main interactions</h2>

        <h3>Register a new user (public registration creates member only)</h3>
        <pre><code>INSERT INTO Users (name, email, password_hash, role)
VALUES (?, ?, ?, 'member');</code></pre>

        <h3>Login (find user by email)</h3>
        <pre><code>SELECT user_id, name, role, password_hash
FROM Users
WHERE email = ?;</code></pre>

        <h3>Browse exercise library (guest/member)</h3>
        <pre><code>SELECT e.exercise_id, e.exercise_name, c.category_name
FROM Exercises e
JOIN Categories c ON e.category_id = c.category_id
ORDER BY c.category_name, e.exercise_name;</code></pre>

        <h3>Create a routine (member)</h3>
        <pre><code>INSERT INTO Routines (user_id, routine_name)
VALUES (?, ?);</code></pre>

        <h3>List routines for a user (member)</h3>
        <pre><code>SELECT routine_id, routine_name
FROM Routines
WHERE user_id = ?
ORDER BY routine_name;</code></pre>

        <h3>View a routine with its exercises</h3>
        <pre><code>SELECT e.exercise_name, re.sets, re.reps, re.exercise_order, c.category_name
FROM Routine_Exercises re
JOIN Exercises e ON re.exercise_id = e.exercise_id
JOIN Categories c ON e.category_id = c.category_id
WHERE re.routine_id = ?
ORDER BY re.exercise_order;</code></pre>

        <h3>Update routine name (member owns routine)</h3>
        <pre><code>UPDATE Routines
SET routine_name = ?
WHERE routine_id = ? AND user_id = ?;</code></pre>

        <h3>Delete routine (member owns routine)</h3>
        <pre><code>DELETE FROM Routines
WHERE routine_id = ? AND user_id = ?;</code></pre>

        <h3>Add an exercise to a routine</h3>
        <pre><code>INSERT INTO Routine_Exercises (routine_id, exercise_id, sets, reps, exercise_order)
VALUES (?, ?, ?, ?, ?);</code></pre>

        <h3>Update sets and reps for an exercise in a routine</h3>
        <pre><code>UPDATE Routine_Exercises
SET sets = ?, reps = ?
WHERE routine_id = ? AND exercise_id = ?;</code></pre>

        <h3>Remove an exercise from a routine</h3>
        <pre><code>DELETE FROM Routine_Exercises
WHERE routine_id = ? AND exercise_id = ?;</code></pre>

        <h3>Admin: create a category</h3>
        <pre><code>INSERT INTO Categories (category_name)
VALUES (?);</code></pre>

        <h3>Admin: create an exercise</h3>
        <pre><code>INSERT INTO Exercises (exercise_name, category_id)
VALUES (?, ?);</code></pre>

        <h3>Admin: update an exercise</h3>
        <pre><code>UPDATE Exercises
SET exercise_name = ?, category_id = ?
WHERE exercise_id = ?;</code></pre>

        <h3>Admin: delete an exercise</h3>
        <pre><code>DELETE FROM Exercises
WHERE exercise_id = ?;</code></pre>
      </section>

      <section aria-labelledby="db-admin-queries">
        <h2 id="db-admin-queries">Admin SQL queries (for admin routes)</h2>
        <p>
          These SQL examples support admin-only routes (user management, routine
          management, and exercise management). Admin users can create new users
          and assign their role (including 'admin').
        </p>

        <h3>Admin: list all users</h3>
        <pre><code>SELECT user_id, name, email, role
FROM Users
ORDER BY user_id DESC;</code></pre>

        <h3>Admin: create a user (admin can assign role)</h3>
        <pre><code>INSERT INTO Users (name, email, password_hash, role)
VALUES (?, ?, ?, ?);</code></pre>

        <h3>Admin: view one user</h3>
        <pre><code>SELECT user_id, name, email, role
FROM Users
WHERE user_id = ?;</code></pre>

        <h3>Admin: update a user</h3>
        <pre><code>UPDATE Users
SET name = ?, email = ?, role = ?
WHERE user_id = ?;</code></pre>

        <h3>Admin: delete a user</h3>
        <pre><code>DELETE FROM Users
WHERE user_id = ?;</code></pre>

        <h3>Admin: list all routines</h3>
        <pre><code>SELECT routine_id, routine_name, user_id
FROM Routines
ORDER BY routine_id DESC;</code></pre>

        <h3>Admin: view one routine</h3>
        <pre><code>SELECT routine_id, routine_name, user_id
FROM Routines
WHERE routine_id = ?;</code></pre>

        <h3>Admin: update a routine</h3>
        <pre><code>UPDATE Routines
SET routine_name = ?
WHERE routine_id = ?;</code></pre>

        <h3>Admin: delete a routine</h3>
        <pre><code>DELETE FROM Routines
WHERE routine_id = ?;</code></pre>

        <h3>Admin: list all exercises</h3>
        <pre><code>SELECT exercise_id, exercise_name, category_id
FROM Exercises
ORDER BY exercise_id DESC;</code></pre>

        <h3>Admin: view one exercise</h3>
        <pre><code>SELECT exercise_id, exercise_name, category_id
FROM Exercises
WHERE exercise_id = ?;</code></pre>
      </section>
    </main>
  </body>
</html>
